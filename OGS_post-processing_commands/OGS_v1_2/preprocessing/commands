#fixes and commands for conversion from Anoplophora glabripennis OGS_v1.1 to OGS_v1.2

# Web Apollo output: need to replace WA auto-generated transcript names (e.g. 1:CUFF.10066.1) with transcript IDs. Should have done this prior to merge. Will likely have to work from a list, rather than auto-identify.

perl ../scripts/replace_WA-autogenerated-transcript-names_w_IDs-2.pl ../../OGS_v1_1/preprocessing/OGS_v1_1_NALmod/agla_v1_1_NALmod4.gff3 transcript_names_to_change.txt agla_v1_2-NALmod1.gff3 >&replace_WA-autogenerated-transcript-names_w_IDs.log&

#there are several models that should have been converted from gene to pseudogene.

perl ../scripts/change_genes_to_pseudogenes_by_list-2.pl gene_to_pseudogene_list.txt agla_v1_2-NALmod1.gff3 agla_v1_2-NALmod2.gff3 >&change_genes_to_pseudogenes_by_list-2.log&

# some minor formatting issues (% sign should be escaped; forgot to use g qualifier on previous sed operation)

sed 's/% /%25 /g' agla_v1_2-NALmod2.gff3 > agla_v1_2-NALmod3.gff3

# some models marked as annotated were not modified in any way by the annotator (likely forgotten). For these, change source of entire model to I5K, change transcript name to transcript ID, and remove owner attribute.
#change source to I5K:
python2.7 ../scripts/fix_source.py
#change transcript name to transript ID: taken care of in above script 'replace_WA-autogenerated-transcript-names_w_IDs.pl'
#remove owner and date-last-modified attribute:

perl ../scripts/remove_owner_date-last-modified_from_mRNA_and_gene.pl agla_v1_2-NALmod4.gff3 agla_v1_2-NALmod5.gff3 >&remove_owner_from_mRNA_and_gene.log&

#name genes without names (use ID)

perl ../scripts/fill_in_gene_names.pl agla_v1_2-NALmod5.gff3 agla_v1_2-NALmod6.gff3 >&fill_in_gene_names.log&

#change isoform suffixes (-RB) to match between name and ID. Best to do this after correcting auto-generated transcript IDs.

perl ../scripts/match_isoform_suffixes.pl agla_v1_2-NALmod6.gff3 agla_v1_2-NALmod7.gff3 >&match_isoform_suffixes.log&

#one-off error from merged set: AGLA026012-RA-E1A should have type pseudogenic_exon. Also, should make sure that this error isn't anywhere else (use Han's script to check and generate new file)

python2.7 ../scripts/fix_pseudogene.py

#create 'official' files
cp agla_v1_2-NALmod8.gff3 ../agla_OGS_v1_2.gff3
